<div class="container-fluid py-5">
  <div class="row justify-content-center">
    <div class="col-12 col-xl-10">

      <!-- Carte principale -->
      <div class="card border-0 shadow-lg rounded-4 overflow-hidden user-management-card">

        <!-- En-tête avec dégradé -->
        <div class="card-header bg-gradient-primary text-white p-4">
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-center">
            <div class="mb-3 mb-md-0">
              <h3 class="mb-1 fw-bold">
                <i class="bi bi-people-fill me-2"></i>Gestion des Utilisateurs
              </h3>
              <p class="mb-0 opacity-75">Administrez les comptes et permissions de votre équipe</p>
            </div>
            <div class="d-flex gap-2">
              <button class="btn btn-light btn-sm fw-semibold d-flex align-items-center" (click)="chargerUtilisateurs()">
                <i class="bi bi-arrow-clockwise me-1"></i> Actualiser
              </button>
              <a routerLink="/users/ajouter" class="btn btn-success btn-sm fw-semibold d-flex align-items-center">
                <i class="bi bi-plus-circle me-1"></i> Nouvel utilisateur
              </a>
            </div>
          </div>
        </div>

        <!-- Filtres -->
        <div class="card-body border-bottom p-4 bg-light">
          <div class="row align-items-end">
            <div class="col-md-6 col-lg-4 mb-3 mb-md-0">
              <label class="form-label small text-muted fw-semibold">Filtrer par rôle</label>
              <select id="roleSelect" class="form-select shadow-sm border-0"
                      [(ngModel)]="selectedRole"
                      (change)="filtrerParRole()">
                <option value="ALL">— Tous les rôles —</option>
                <option value="admin">Administrateur</option>
                <option value="eleve">Eleve</option>
                <option value="parent">Parent</option>
                <option value="prof">Professeur</option>

              </select>
            </div>
            <div class="col-md-6 col-lg-8">
              <div class="d-flex justify-content-md-end gap-2">
                <div class="stat-badge bg-primary">
                  <span class="number">{{ utilisateurs.length }}</span>
                  <span class="label">Total</span>
                </div>
                <div class="stat-badge bg-danger">
                  <span class="number">{{ getCountByRole('admin') }}</span>
                  <span class="label">Admins</span>
                </div>
                <div class="stat-badge bg-warning">
                  <span class="number">{{ getCountByRole('prof') }}</span>
                  <span class="label">Professeurs</span>
                </div>
                <div class="stat-badge bg-black">
                  <span class="number">{{ getCountByRole('eleve') }}</span>
                  <span class="label">Eleve</span>
                </div>
                <div class="stat-badge bg-secondary">
                  <span class="number">{{ getCountByRole('parent') }}</span>
                  <span class="label">Parent</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tableau -->
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th class="ps-4 py-3 text-muted small fw-semibold border-0">#</th>
                  <th class="py-3 text-muted small fw-semibold border-0">PRÉNOM</th>
                  <th class="py-3 text-muted small fw-semibold border-0">NOM</th>
                  <th class="py-3 text-muted small fw-semibold border-0">EMAIL</th>
                   <th class="py-3 text-muted small fw-semibold border-0">RÔLE</th>
                  <th class="pe-4 py-3 text-muted small fw-semibold border-0 text-center">ACTIONS</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let u of utilisateurs; let i = index" class="user-row">
                  <td class="ps-4 py-3 fw-semibold text-muted">{{ i + 1 }}</td>
                  <td class="py-3">
                    <div class="d-flex align-items-center">
                      <div class="avatar-sm bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3">
                        {{ (u.prenom?.charAt(0) || 'U' ) | uppercase }}
                      </div>
                      <span class="fw-medium text-dark">{{ u.prenom ?? '—' }}</span>
                    </div>
                  </td>
                  <td class="py-3 fw-medium text-dark">{{ u.nom ?? '—' }}</td>
                  <td class="py-3">
                    <span class="text-truncate d-inline-block" style="max-width: 200px;" title="{{ u.email }}">
                      {{ u.email }}
                    </span>
                  </td>

                  <td class="py-3">
                    <span class="badge rounded-pill fw-semibold px-3 py-2" [ngClass]="{
                      'bg-danger': u.role === 'admin',
                      'bg-warning': u.role === 'prof',
                      'bg-success': u.role === 'parent',
                       'bg-gradient-primary': u.role === 'eleve'

                    }">
                      {{ u.role ?? '—' }}
                    </span>
                  </td>
                  <td class="pe-4 py-3 text-center">
                    <div class="btn-group btn-group-sm" role="group">
                      <button class="btn btn-outline-primary rounded-start" title="Modifier"
                              (click)="modifierUtilisateur(u)">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button class="btn btn-outline-warning" title="Admin"
                              (click)="changeUserRole(u, 'ADMIN')">
                        <i class="bi bi-person-gear"></i>
                      </button>
                      <button class="btn btn-outline-danger rounded-end" title="Supprimer"
                              (click)="supprimerUtilisateur(u.id)">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>

                <tr *ngIf="utilisateurs.length === 0">
                  <td colspan="7" class="text-center text-muted p-5">
                    <div class="py-4">
                      <i class="bi bi-people display-4 opacity-25"></i>
                      <p class="mt-3 mb-0 fw-medium">Aucun utilisateur trouvé</p>
                      <small class="text-muted">Essayez de modifier vos filtres ou ajoutez un nouvel utilisateur</small>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>

<!-- Pagination -->
<div class="d-flex justify-content-end align-items-center p-4">
  <nav>
    <ul class="pagination mb-0">
      <!-- Précédent -->
      <li class="page-item" [class.disabled]="page <= 1">
        <button class="page-link" (click)="changePage(page - 1)">
          <i class="bi bi-chevron-left"></i> Précédent
        </button>
      </li>

      <!-- Pages dynamiques -->
      <li *ngFor="let p of [].constructor(totalPages); let i = index"
          class="page-item"
          [class.active]="page === i + 1">
        <button class="page-link" (click)="changePage(i + 1)">
          {{ i + 1 }}
        </button>
      </li>

      <!-- Suivant -->
      <li class="page-item" [class.disabled]="page >= totalPages">
        <button class="page-link" (click)="changePage(page + 1)">
          Suivant <i class="bi bi-chevron-right"></i>
        </button>
      </li>
    </ul>
  </nav>
</div>




          </div>
        </div>
      </div>
    </div>
  </div>
</div>
